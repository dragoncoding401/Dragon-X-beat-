<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>حل المعادلات | Dragon X</title>

  <!-- External CSS Libraries -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

  <!-- SEO -->
  <meta name="keywords" content="خطوات حل المعادلات, شرح المعادلات خطوة بخطوة, حل المعادلات الرياضية, Dragon X">

  <!-- Icon -->
  <link rel="icon" href="icon.png">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- External JS Libraries -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/nerdamer@1.1.13/all.min.js"></script>
  <script src="./lib/pdfmaker/pdfmake.min.js"></script>
  <script src="./lib/pdfmaker/vfs_fonts.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="./style.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #121212;
      color: white;
    }
    .equation-input {
      background-color: #1e1e1e;
      border: 2px solid #333;
      transition: all 0.3s;
    }
    .equation-input:focus {
      border-color: #ff0000;
      box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.2);
    }
    .result-card {
      background: linear-gradient(135deg, #1e1e1e 0%, #2a0a0a 100%);
      border-left: 4px solid #ff0000;
    }
    input, select, button{
        outline: none;
    }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-14BZZY3CE6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-14BZZY3CE6');
</script>
</head>
<body class="min-h-screen">
  <!-- Navbar -->
  <nav class="bg-black/50 backdrop-blur-md py-4 px-6 fixed w-full z-50">
    <div class="container mx-auto flex justify-between items-center">
      <div class="flex items-center space-x-2 space-x-reverse">
        <i data-feather="code" class="text-red-500"></i>
        <span class="text-xl font-bold text-white">Dragon X (beta)</span>
      </div>
      <div class="hidden md:flex space-x-8 space-x-reverse">
        <a href="index.html" class="text-white hover:text-red-500 line">الرئيسية</a>
        <a href="equation-solver.html" class="text-red-500 font-bold line">حل المعادلات</a>
        <a href="about-us.html" class="text-white hover:text-red-500 line">عنّا</a>
        <a href="contact-us.html" class="text-white hover:text-red-500 line">تواصل معنا</a>
      </div>
      <button class="md:hidden text-white" id="mobile-menu-button">
        <i data-feather="menu"></i>
      </button>
    </div>
    <!-- Mobile Menu -->
    <div class="md:hidden hidden bg-black/80 py-4 px-6" id="mobile-menu">
      <div class="flex flex-col space-y-4">
        <a href="index.html" class="text-white hover:text-red-500">الرئيسية</a>
        <a href="equation-solver.html" class="text-red-500 font-bold">حل المعادلات</a>
        <a href="about-us.html" class="text-white hover:text-red-500">عنّا</a>
        <a href="contact-us.html" class="text-white hover:text-red-500">تواصل معنا</a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="min-h-screen pt-24 pb-16">
    <div class="container mx-auto px-6">
      <h1 class="text-3xl md:text-4xl font-bold mb-12 text-center" data-aos="fade-up">حل المعادلات الرياضية</h1>
      
      <div class="max-w-3xl mx-auto">
        <!-- Equation Form -->
        <div class="bg-gray-800 rounded-xl p-6 mb-8" data-aos="fade-up" data-aos-delay="100">
          <form id="equation-form">
            <div class="mb-6">
              <label for="equation" class="block text-lg font-medium mb-3">أدخل المعادلة:</label>
              <input type="text" id="equation" class="equation-input w-full px-4 py-3 rounded-lg text-white" placeholder="مثال: 2x + 5 = 10" required>
            </div>
            
            <div class="mb-8">
              <label for="equation-type" class="block text-lg font-medium mb-3">نوع المعادلة:</label>
              <select id="equation-type" class="equation-input w-full px-4 py-3 rounded-lg text-white">
                <option value="linear">معادلة خطية</option>
                <option value="quadratic">معادلة تربيعية</option>
                <option value="polynomial">معادلة متعددة الحدود</option>
              </select>
            </div>
            
            <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg flex items-center justify-center transition duration-300">
              حل المعادلة
              <i data-feather="chevrons-left" class="mr-2"></i>
            </button>
          </form>
        </div>
        
        <!-- Result Section -->
        <div id="result-section" class="hidden" data-aos="fade-up" data-aos-delay="200">
          <div class="result-card rounded-xl p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4 text-red-500">النتيجة</h2>
            <div id="equation-result" class="text-xl mb-6">
              <!-- Here the solution will appear -->
            </div>
            <div class="flex space-x-4 space-x-reverse">
              <a id="steps-link" href="#" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg flex items-center transition duration-300">
                عرض الخطوات
                <i data-feather="list" class="mr-2"></i>
              </a>
              <button onclick="exportPDF();" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg flex items-center transition duration-300">
                حفظ كـ PDF
                <i data-feather="download" class="mr-2"></i>
              </button>
            </div>
          </div>

        <!-- instructions-section -->
        <div class="bg-gray-800 rounded-xl p-6" data-aos="fade-up" data-aos-delay="200">
          <div class="flex justify-between items-center mb-3">
            <h3 class="text-lg font-bold flex items-center">
              <i data-feather="info" class="text-red-500 mr-2"></i>
              نصائح مهمة
            </h3>
            <button id="toggle-instructions" class="text-sm bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">
              إخفاء
            </button>
          </div>
          <ul id="instructions-section" class="list-disc pr-5 space-y-2 text-gray-300 hidden">
            <li>تأكد من كتابة المعادلة بشكل صحيح</li>
            <li>استخدم علامة * للضرب (مثال: 2*x بدلاً من 2x)</li>
            <li>للقوى استخدم ^ (مثال: x^2 + 3x + 2 = 0)</li>
            <li>استخدم الأقواس لتحديد أولويات العمليات</li>
          </ul>
        </div>

        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-black py-8">
    <div class="container mx-auto px-6">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-6 md:mb-0">
          <div class="flex items-center space-x-2 space-x-reverse">
            <i data-feather="code" class="text-red-500"></i>
            <span class="text-xl font-bold text-white">Dragon Coding</span>
          </div>
          <p class="text-gray-500 mt-2">نحو تعليم رياضي أفضل</p>
        </div>
        <div class="flex space-x-6 space-x-reverse">
          <a href="https://dragon-coding-team-website.netlify.app/" target="_blank" class="text-gray-400 hover:text-red-500 text-2xl">
            <i class="fa-solid fa-globe"></i>
          </a>
          <a href="https://discord.gg/9yubUP25" target="_blank" class="text-gray-400 hover:text-red-500 text-2xl">
            <i class="fa-brands fa-discord"></i>
          </a>
          <a href="https://www.tiktok.com/@dragon_coding_team?_t=ZS-8zGKGXVi3R1&_r=1" target="_blank" class="text-gray-400 hover:text-red-500 text-2xl">
            <i class="fa-brands fa-tiktok"></i>
          </a>
        </div>
      </div>
      <hr class="border-gray-800 my-6">
      <div class="text-center text-gray-500">
        <p>© 2025 Dragon Coding. جميع الحقوق محفوظة</p>
      </div>
    </div>
  </footer>

  <!-- Custom JS -->
  <script>
// Global variables
let equation_pdf = "";
let type_pdf = "";
let simplified_pdf = "";
let solution_pdf = "";
let roots_pdf = []; // store roots globally

// Init AOS
AOS.init({
  duration: 800,
  easing: "ease-in-out",
  once: true,
});

// Init feather icons
feather.replace();

// Mobile menu toggle
const mobileMenuButton = document.getElementById("mobile-menu-button");
const mobileMenu = document.getElementById("mobile-menu");
mobileMenuButton.addEventListener("click", () => {
  mobileMenu.classList.toggle("hidden");
  feather.replace();
});

// Handle form submit
document.getElementById("equation-form").addEventListener("submit", function (e) {
  e.preventDefault();

  const submitButton = this.querySelector('button[type="submit"]');
  const originalText = submitButton.innerHTML;
  submitButton.innerHTML = `
  جاري الحل<span class="loading-dots">
    <span>.</span><span>.</span><span>.</span>
  </span>
`;
  submitButton.disabled = true;

  const equation = document.getElementById("equation").value.trim();
  const type = document.getElementById("equation-type").value;
  const resultDiv = document.getElementById("equation-result");

  setTimeout(() => {
    if (!equation) {
      Swal.fire({
        title: "تحذير",
        icon: "warning",
        text: "من فضلك أدخل معادلة صحيحة",
        confirmButtonText: "حسناً"
      });
      submitButton.innerHTML = originalText;
      submitButton.disabled = false;
      return;
    }

    // Split sides of the equation
    let sides = equation.split("=");
    let left = sides[0];
    let right = sides[1] || "0";
    let simplified = `${left} = ${right}`;

    // Solve equation
    let solutionHTML = "";
    let roots = [];
    try {
      let expr = `${left}-(${right})`;
      roots = nerdamer.solveEquations(expr, "x");

      if (roots && roots.length > 0) {
        solutionHTML =
          "<ul class='pl-5 space-y-2'>" +
          roots
            .map((r, i) => {
              let rootStr = r.toString();
              let numericValue;
              try {
                numericValue = nerdamer(rootStr).evaluate().text();
              } catch (e) {
                numericValue = rootStr;
              }

              // Format decimal numbers
              let decimal =
                !isNaN(parseFloat(numericValue))
                  ? parseFloat(numericValue).toFixed(1)
                  : numericValue;

              // Format complex numbers
              if (decimal.includes("i")) decimal = decimal.replace("*i", "i").replace(/\s+/g, "");

              return `
                <li class="flex items-center gap-2 p-2 rounded-lg bg-gray-100 shadow-sm" style="margin-top: 10px;">
                  <span class="text-blue-600 font-medium">الحل ${i + 1}:</span>
                  <b class="text-gray-800">${decimal}</b>
                </li>`;
            })
            .join("") +
          "</ul>";
      } else {
        solutionHTML = "<span class='text-red-500'>لا يوجد حل</span>";
      }
    } catch (err) {
      Swal.fire({
        title: "خطأ",
        icon: "error",
        text: "حدث خطأ ما. من فضلك تأكد من كتابة المعادلة بشكل صحيح و أعد المحاولة",
        confirmButtonText: "حسناً"
      });
    }

    // Store global PDF data
    equation_pdf = equation;
    type_pdf = type;
    simplified_pdf = simplified;
    solution_pdf = solutionHTML;
    roots_pdf = roots; // store roots globally for PDF

    // Show results section
    document.getElementById("result-section").classList.remove("hidden");

    // Display result
    resultDiv.innerHTML = `
      <p class="mb-2"><span class="text-gray-400">المعادلة:</span> ${equation}</p>
      <p class="mb-2"><span class="text-gray-400">النوع:</span> ${
        type === "linear" ? "خطية" : type === "quadratic" ? "تربيعية" : "متعددة الحدود"
      }</p>
      <p class="mt-4"><span class="text-gray-400">التبسيط:</span> <b>${simplified}</b></p>
      <div class="mt-4"><span class="text-gray-400">الحل:</span> ${solutionHTML}</div>
    `;

    submitButton.innerHTML = originalText;
    submitButton.disabled = false;

    // Smooth scroll to results
    document.getElementById("result-section").scrollIntoView({ behavior: "smooth" });

  }, 1500);
});

    // Show instructions automatically
    const instructions = document.getElementById("instructions-section");
    if (instructions) instructions.classList.remove("hidden");

    // Handle toggle instructions button
    const toggleBtn = document.getElementById("toggle-instructions");
    if (toggleBtn) {
      toggleBtn.addEventListener("click", () => {
        instructions.classList.toggle("hidden");
        toggleBtn.innerText = instructions.classList.contains("hidden") ? "إظهار" : "إخفاء";
      });
    }

// Exporting Arabic fonts
pdfMake.fonts = {
  Cairo: {
    normal: 'Cairo-Regular.ttf',
    bold: 'Cairo-Bold.ttf',
  }
};

// A function that reverses the order of words, not letters.
function fixArabicText(str) {
  if (!str) return "";

  // Text segmentation: (Arabic) | (Decimals) | (Numbers) | (Symbols) | (English)
  const parts = str.match(/[\u0600-\u06FF]+|[-+]?\d+(\.\d+)?|[:=+\-*/().]+|[a-zA-Z]+/g);

  if (!parts) return str;

  // We just reverse the order
  return parts.reverse().join(" ");
}

// Export PDF function (Arabic + Better Design)
function exportPDF() {
  // Format solutions array for PDF
  const solutionsArr =
    roots_pdf && roots_pdf.length > 0
      ? roots_pdf.map((r, i) => {
          let val;
          try {
            val = nerdamer(r.toString()).evaluate().text();
          } catch {
            val = r.toString();
          }

          // Format decimals / complex numbers
          if (val.includes("i")) val = val.replace(/\*i/g, "i").replace(/\s+/g, "");
          else val = parseFloat(val).toFixed(1);

          return fixArabicText(`الحل ${i + 1}: ${val}`);
        })
      : [fixArabicText("لا يوجد حل")];

  // PDF document definition
  const docDefinition = {
    content: [
      { text: fixArabicText("نتيجة حل المعادلة"), style: "header", alignment: "center", margin: [0, 0, 0, 20] },
      { text: fixArabicText(`المعادلة: ${equation_pdf}`), style: "field" },
      { text: fixArabicText(`نوع المعادلة: ${type_pdf === "linear" ? "خطية" : type_pdf === "quadratic" ? "تربيعية" : "متعددة الحدود"}`), style: "field" },
      { text: fixArabicText(`التبسيط: ${simplified_pdf}`), style: "field" },
      { text: fixArabicText("الحلول:"), style: "solutionHeader", margin: [0, 15, 0, 10] },
      ...solutionsArr.map(s => ({
        text: s,
        style: "solutionCard",
        margin: [0, 5, 0, 5]
      }))
    ],
    defaultStyle: {
      font: "Cairo",
      alignment: "right",
    },
    styles: {
      header: { fontSize: 22, bold: true, color: "#e63946" },
      field: { fontSize: 16, margin: [0, 5, 0, 10], color: "#1d3557" },
      solutionHeader: { fontSize: 18, bold: true, color: "#2b2d42" },
      solutionCard: {
        fontSize: 15,
        color: "#333",
        margin: [0, 5, 0, 5],
        fillColor: "#f8f9fa",
        border: [true, true, true, true],
        borderColor: "#dee2e6",
        borderRadius: 6
      }
    },
    pageMargins: [50, 60, 50, 60],
    pageOrientation: "portrait"
  };

  pdfMake.createPdf(docDefinition).download("نتيجة_حل_المعادلة.pdf");
}

  // Go to the solution steps page
  let steps_link = document.getElementById("steps-link");
  steps_link.addEventListener("click", ()=>{
    // Store the equation
    window.location.href = `solution-steps.html?equcation=${encodeURIComponent(equation_pdf)}&type=${encodeURIComponent(type_pdf)}&solution=${encodeURIComponent(solution_pdf)}`;
  });
  </script>
</body>
</html>